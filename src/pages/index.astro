---
import { getCollection } from "astro:content";
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogPost from "../components/BlogPost.astro";
import type { SanityDocument } from "@sanity/client";
import { loadQuery } from "../sanity/lib/load-query";

export async function getStaticPaths() {
	const { data: posts } = await loadQuery<SanityDocument[]>({
		query: `*[_type == "post"]`
	})

	return posts.map(({slug}) => {
		return {
			params: {
				slug: slug.current
			}
		}
	})
}


const { slug } = Astro.params;

const allPosts = (await getCollection("allBlog")).sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
---

<BaseLayout pageTitle="Food's Tech Blog">
	<div class="flex-grow w-5/6 m-auto">

		<div class="flex flex-col pb-64">

			<div class="flex md:text-4xl font-bold py-8 md:py-16 xl:p-16 xl:px-32">
				<p>Latest Posts</p>
			</div>
			<div class="grid md:grid-cols-2 xl:grid-cols-3 mb-16 gap-4 xl:px-32">
				{
					allPosts.map((post) => (
						<BlogPost post={post} url={post.id}/>
					))
				}
			</div>
			  
		</div>

	</div>
</BaseLayout>
